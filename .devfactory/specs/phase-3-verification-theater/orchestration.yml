version: "4.5"
spec: phase-3-verification-theater
generated: 2024-12-05T09:30:00Z

summary:
  total_tasks: 28
  layers:
    database: 0
    backend: 14
    frontend: 10
    testing: 4
  parallel_batches: 10
  depends_on: ["phase-2-factory-floor"]

tasks:
  # ============================================
  # BACKEND LAYER - Playwright Infrastructure
  # ============================================

  - id: "1.1"
    title: "Create packages/theater directory with TypeScript"
    layer: backend
    depends_on: []
    parallel_batch: 1

  - id: "1.2"
    title: "Install Playwright and configure headed mode"
    layer: backend
    depends_on: ["1.1"]
    parallel_batch: 2

  - id: "1.3"
    title: "Create BrowserManager class"
    layer: backend
    depends_on: ["1.2"]
    parallel_batch: 3

  - id: "1.4"
    title: "Implement screenshot capture with base64"
    layer: backend
    depends_on: ["1.3"]
    parallel_batch: 4

  - id: "1.5"
    title: "Create WebSocket stream for screenshots"
    layer: backend
    depends_on: ["1.4"]
    parallel_batch: 5

  # ============================================
  # BACKEND LAYER - Test Scenario System
  # ============================================

  - id: "2.1"
    title: "Define TestScenario and TestStep interfaces"
    layer: backend
    depends_on: ["1.1"]
    parallel_batch: 2

  - id: "2.2"
    title: "Create ScenarioLoader - load from JSON"
    layer: backend
    depends_on: ["2.1"]
    parallel_batch: 3

  - id: "2.3"
    title: "Create ScenarioGenerator - from spec acceptance criteria"
    layer: backend
    depends_on: ["2.1"]
    parallel_batch: 3

  - id: "2.4"
    title: "Create ScenarioRunner - execute steps"
    layer: backend
    depends_on: ["2.2", "1.3"]
    parallel_batch: 4

  - id: "2.5"
    title: "Implement step action handlers"
    layer: backend
    depends_on: ["2.4"]
    parallel_batch: 5

  # ============================================
  # BACKEND LAYER - Verification Orchestrator
  # ============================================

  - id: "3.1"
    title: "Create VerificationOrchestrator class"
    layer: backend
    depends_on: ["2.4"]
    parallel_batch: 5

  - id: "3.2"
    title: "Implement scenario prioritization"
    layer: backend
    depends_on: ["3.1"]
    parallel_batch: 6

  - id: "3.3"
    title: "Implement verification loop (run/check/fix/retry)"
    layer: backend
    depends_on: ["3.2", "5.5"]
    parallel_batch: 8

  - id: "3.4"
    title: "Create verification state management"
    layer: backend
    depends_on: ["3.1"]
    parallel_batch: 6

  - id: "3.5"
    title: "Add WebSocket events for verification status"
    layer: backend
    depends_on: ["3.4", "1.5"]
    parallel_batch: 7

  # ============================================
  # BACKEND LAYER - Browser Explorer Agent
  # ============================================

  - id: "4.1"
    title: "Create BrowserExplorer agent definition"
    layer: backend
    depends_on: ["1.3"]
    parallel_batch: 4

  - id: "4.2"
    title: "Implement page context analysis"
    layer: backend
    depends_on: ["4.1"]
    parallel_batch: 5

  - id: "4.3"
    title: "Implement element finder"
    layer: backend
    depends_on: ["4.2"]
    parallel_batch: 6

  - id: "4.4"
    title: "Create exploratory mode"
    layer: backend
    depends_on: ["4.3"]
    parallel_batch: 7

  # ============================================
  # BACKEND LAYER - Issue Detection & Fixing
  # ============================================

  - id: "5.1"
    title: "Create IssueDetector class"
    layer: backend
    depends_on: ["1.3"]
    parallel_batch: 4

  - id: "5.2"
    title: "Implement console error capture"
    layer: backend
    depends_on: ["5.1"]
    parallel_batch: 5

  - id: "5.3"
    title: "Implement network error detection"
    layer: backend
    depends_on: ["5.1"]
    parallel_batch: 5

  - id: "5.4"
    title: "Create FixEngine with subagent spawning"
    layer: backend
    depends_on: ["5.2", "5.3"]
    parallel_batch: 6

  - id: "5.5"
    title: "Implement fix retry logic"
    layer: backend
    depends_on: ["5.4"]
    parallel_batch: 7

  # ============================================
  # BACKEND LAYER - Thought Stream
  # ============================================

  - id: "6.1"
    title: "Create ThoughtStream class"
    layer: backend
    depends_on: ["1.1"]
    parallel_batch: 2

  - id: "6.2"
    title: "Implement thought formatting"
    layer: backend
    depends_on: ["6.1"]
    parallel_batch: 3

  - id: "6.3"
    title: "Add WebSocket emission for thoughts"
    layer: backend
    depends_on: ["6.2", "1.5"]
    parallel_batch: 6

  - id: "6.4"
    title: "Create thought log persistence"
    layer: backend
    depends_on: ["6.2"]
    parallel_batch: 4

  # ============================================
  # FRONTEND LAYER - Theater UI
  # ============================================

  - id: "7.1"
    title: "Create Theater page component"
    layer: frontend
    depends_on: ["3.5"]
    parallel_batch: 8

  - id: "7.2"
    title: "Create BrowserView component"
    layer: frontend
    depends_on: ["7.1", "1.5"]
    parallel_batch: 9

  - id: "7.3"
    title: "Implement cursor overlay"
    layer: frontend
    depends_on: ["7.2"]
    parallel_batch: 9

  - id: "7.4"
    title: "Create ScenarioSteps component"
    layer: frontend
    depends_on: ["7.1"]
    parallel_batch: 9

  - id: "7.5"
    title: "Create ThoughtStreamPanel component"
    layer: frontend
    depends_on: ["7.1", "6.3"]
    parallel_batch: 9

  - id: "7.6"
    title: "Create StatusBar component"
    layer: frontend
    depends_on: ["7.1"]
    parallel_batch: 9

  # ============================================
  # FRONTEND LAYER - Integration
  # ============================================

  - id: "8.1"
    title: "Add Open Theater button to dashboard"
    layer: frontend
    depends_on: ["7.1"]
    parallel_batch: 9

  - id: "8.2"
    title: "Create TheaterMiniStatus component"
    layer: frontend
    depends_on: ["7.1"]
    parallel_batch: 9

  - id: "8.3"
    title: "Connect Theater to WebSocket"
    layer: frontend
    depends_on: ["7.2", "7.4", "7.5"]
    parallel_batch: 10

  - id: "8.4"
    title: "Implement theater open/close coordination"
    layer: frontend
    depends_on: ["8.1", "8.3"]
    parallel_batch: 10

  # ============================================
  # TESTING LAYER
  # ============================================

  - id: "9.1"
    title: "Unit tests for ScenarioRunner"
    layer: testing
    depends_on: ["2.5"]
    parallel_batch: 6

  - id: "9.2"
    title: "Unit tests for IssueDetector"
    layer: testing
    depends_on: ["5.3"]
    parallel_batch: 6

  - id: "9.3"
    title: "Integration test for verification flow"
    layer: testing
    depends_on: ["3.3"]
    parallel_batch: 9

  - id: "9.4"
    title: "E2E test for Theater UI"
    layer: testing
    depends_on: ["8.4"]
    parallel_batch: 11

execution_order:
  - batch: 1
    tasks: ["1.1"]
    workers: [df-backend]

  - batch: 2
    tasks: ["1.2", "2.1", "6.1"]
    workers: [df-backend]
    parallel: true

  - batch: 3
    tasks: ["1.3", "2.2", "2.3", "6.2"]
    workers: [df-backend]
    parallel: true

  - batch: 4
    tasks: ["1.4", "2.4", "4.1", "5.1", "6.4"]
    workers: [df-backend]
    parallel: true

  - batch: 5
    tasks: ["1.5", "2.5", "3.1", "4.2", "5.2", "5.3"]
    workers: [df-backend]
    parallel: true

  - batch: 6
    tasks: ["3.2", "3.4", "4.3", "5.4", "6.3", "9.1", "9.2"]
    workers: [df-backend, df-testing]
    parallel: true

  - batch: 7
    tasks: ["3.5", "4.4", "5.5"]
    workers: [df-backend]
    parallel: true

  - batch: 8
    tasks: ["3.3", "7.1"]
    workers: [df-backend, df-frontend]
    parallel: true

  - batch: 9
    tasks: ["7.2", "7.3", "7.4", "7.5", "7.6", "8.1", "8.2", "9.3"]
    workers: [df-frontend, df-testing]
    parallel: true

  - batch: 10
    tasks: ["8.3", "8.4"]
    workers: [df-frontend]
    parallel: true

  - batch: 11
    tasks: ["9.4"]
    workers: [df-testing]

worker_assignments:
  df-backend:
    tasks: ["1.1", "1.2", "1.3", "1.4", "1.5",
            "2.1", "2.2", "2.3", "2.4", "2.5",
            "3.1", "3.2", "3.3", "3.4", "3.5",
            "4.1", "4.2", "4.3", "4.4",
            "5.1", "5.2", "5.3", "5.4", "5.5",
            "6.1", "6.2", "6.3", "6.4"]

  df-frontend:
    tasks: ["7.1", "7.2", "7.3", "7.4", "7.5", "7.6",
            "8.1", "8.2", "8.3", "8.4"]

  df-testing:
    tasks: ["9.1", "9.2", "9.3", "9.4"]

notes:
  - This phase requires Phase 2 dashboard to be complete
  - Backend-heavy in early batches (Playwright setup)
  - Frontend work starts in batch 8 once WebSocket events ready
  - Testing starts in batch 6 once components testable
  - Playwright headed mode may require Xvfb in CI environments
